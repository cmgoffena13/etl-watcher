<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watcher Diagnostics</title>
    <style>
        /* Custom color theme for Watcher */
        /* Color palette: #011F26, #013A40, #EBF2F2, #4F8C8C, #260A08 */
        
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background-color: #011F26;
            color: #EBF2F2;
            margin: 0;
            padding: 20px;
            line-height: 1.4;
        }
        .container {
            max-width: none;
            margin: 0 auto;
            width: 100%;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #4F8C8C;
            margin-bottom: 10px;
        }
        .nav {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }
        .nav button {
            background-color: #013A40;
            color: #EBF2F2;
            border: 1px solid #4F8C8C;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
            font-family: inherit;
        }
        .nav button:hover {
            background-color: #4F8C8C;
            color: #011F26;
        }
        .nav button.active {
            background-color: #4F8C8C;
            color: #011F26;
        }
        .output {
            background-color: #013A40;
            border: 1px solid #4F8C8C;
            border-radius: 4px;
            padding: 20px;
            white-space: pre-wrap;
            font-size: 14px;
            overflow-x: auto;
            min-height: 400px;
            max-width: 100%;
            width: 100%;
            box-sizing: border-box;
            word-wrap: break-word;
        }
        .loading {
            color: #4F8C8C;
            text-align: center;
            padding: 20px;
        }
        .error {
            color: #EBF2F2;
            background-color: #260A08;
            border: 1px solid #260A08;
            border-radius: 4px;
            padding: 20px;
            margin: 20px 0;
        }
        .success {
            color: #4F8C8C;
        }
        .warning {
            color: #4F8C8C;
        }
        .info {
            color: #4F8C8C;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Watcher Diagnostics</h1>
            <p>System health and performance monitoring</p>
        </div>
        
        <div class="nav">
            <button onclick="loadDiagnostic('connection-performance')" class="active">DB Connection</button>
            <button onclick="loadDiagnostic('schema-health')">DB Schema Health</button>
            <button onclick="loadDiagnostic('performance')">DB Performance & Locks</button>
            <button onclick="loadDiagnostic('redis')">Redis Connection</button>
            <button onclick="loadDiagnostic('celery')">Celery Workers</button>
        </div>
        
        <div id="output" class="output"></div>
    </div>

    <script>
        let currentDiagnostic = 'connection-performance';
        
        async function loadDiagnostic(type) {
            currentDiagnostic = type;
            updateActiveButton(type);
            
            const output = document.getElementById('output');
            let loadingMessage = 'Loading ' + type.replace('-', ' ') + ' diagnostics...<br><small style="color: #888;">This may take a few seconds...</small>';
            output.innerHTML = '<div class="loading">' + loadingMessage + '</div>';
            
            try {
                const response = await fetch(`/diagnostics/${type}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    output.innerHTML = `<div class="success">${data.output}</div>`;
                } else {
                    output.innerHTML = `<div class="error">Error: ${escapeHtml(data.error || 'Unknown error')}</div>`;
                }
            } catch (error) {
                output.innerHTML = `<div class="error">Failed to load diagnostics: ${escapeHtml(error.message)}</div>`;
            }
        }
        
        
        function updateActiveButton(type) {
            document.querySelectorAll('.nav button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Load initial diagnostic
        loadDiagnostic('connection-performance');
    </script>
</body>
</html>
