apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "watcher.fullname" . }}-config
  labels:
    {{- include "watcher.labels" . | nindent 4 }}
data:
  # Environment state
  ENV_STATE: {{ .Values.watcher.envState | quote }}
  
  # Database configuration
  {{- if eq .Values.watcher.envState "dev" }}
  DEV_DATABASE_URL: {{ .Values.watcher.database.url | quote }}
  DEV_REDIS_URL: {{ .Values.watcher.redis.url | quote }}
  DEV_WATCHER_AUTO_CREATE_ANOMALY_DETECTION_RULES: {{ .Values.watcher.watcherAutoCreateAnomalyDetectionRules | quote }}
  DEV_PROFILING_ENABLED: {{ .Values.watcher.watcherProfilingEnabled | quote }}
  DEV_WATCHER_TIMELINESS_CHECK_LOOKBACK_MINUTES: {{ .Values.watcher.watcherTimelinessCheckLookbackMinutes | quote }}
  DEV_WATCHER_TIMELINESS_CHECK_SCHEDULE: {{ .Values.watcher.watcherTimelinessCheckSchedule | quote }}
  DEV_WATCHER_FRESHNESS_CHECK_SCHEDULE: {{ .Values.watcher.watcherFreshnessCheckSchedule | quote }}
  DEV_WATCHER_CELERY_QUEUE_HEALTH_CHECK_SCHEDULE: {{ .Values.watcher.watcherCeleryQueueHealthCheckSchedule | quote }}
  {{- if .Values.watcher.logfire.token }}
  DEV_LOGFIRE_TOKEN: {{ .Values.watcher.logfire.token | quote }}
  {{- end }}
  {{- if .Values.watcher.slack.webhookUrl }}
  DEV_SLACK_WEBHOOK_URL: {{ .Values.watcher.slack.webhookUrl | quote }}
  {{- end }}
  {{- else if eq .Values.watcher.envState "test" }}
  TEST_DATABASE_URL: {{ .Values.watcher.database.url | quote }}
  TEST_REDIS_URL: {{ .Values.watcher.redis.url | quote }}
  TEST_WATCHER_AUTO_CREATE_ANOMALY_DETECTION_RULES: {{ .Values.watcher.watcherAutoCreateAnomalyDetectionRules | quote }}
  TEST_PROFILING_ENABLED: {{ .Values.watcher.watcherProfilingEnabled | quote }}
  TEST_WATCHER_TIMELINESS_CHECK_LOOKBACK_MINUTES: {{ .Values.watcher.watcherTimelinessCheckLookbackMinutes | quote }}
  TEST_WATCHER_TIMELINESS_CHECK_SCHEDULE: {{ .Values.watcher.watcherTimelinessCheckSchedule | quote }}
  TEST_WATCHER_FRESHNESS_CHECK_SCHEDULE: {{ .Values.watcher.watcherFreshnessCheckSchedule | quote }}
  TEST_WATCHER_CELERY_QUEUE_HEALTH_CHECK_SCHEDULE: {{ .Values.watcher.watcherCeleryQueueHealthCheckSchedule | quote }}
  {{- if .Values.watcher.logfire.token }}
  TEST_LOGFIRE_TOKEN: {{ .Values.watcher.logfire.token | quote }}
  {{- end }}
  {{- if .Values.watcher.slack.webhookUrl }}
  TEST_SLACK_WEBHOOK_URL: {{ .Values.watcher.slack.webhookUrl | quote }}
  {{- end }}
  {{- else }}
  PROD_DATABASE_URL: {{ .Values.watcher.database.url | quote }}
  PROD_REDIS_URL: {{ .Values.watcher.redis.url | quote }}
  PROD_WATCHER_AUTO_CREATE_ANOMALY_DETECTION_RULES: {{ .Values.watcher.watcherAutoCreateAnomalyDetectionRules | quote }}
  PROD_PROFILING_ENABLED: {{ .Values.watcher.watcherProfilingEnabled | quote }}
  PROD_WATCHER_TIMELINESS_CHECK_LOOKBACK_MINUTES: {{ .Values.watcher.watcherTimelinessCheckLookbackMinutes | quote }}
  PROD_WATCHER_TIMELINESS_CHECK_SCHEDULE: {{ .Values.watcher.watcherTimelinessCheckSchedule | quote }}
  PROD_WATCHER_FRESHNESS_CHECK_SCHEDULE: {{ .Values.watcher.watcherFreshnessCheckSchedule | quote }}
  PROD_WATCHER_CELERY_QUEUE_HEALTH_CHECK_SCHEDULE: {{ .Values.watcher.watcherCeleryQueueHealthCheckSchedule | quote }}
  {{- if .Values.watcher.logfire.token }}
  PROD_LOGFIRE_TOKEN: {{ .Values.watcher.logfire.token | quote }}
  {{- end }}
  {{- if .Values.watcher.slack.webhookUrl }}
  PROD_SLACK_WEBHOOK_URL: {{ .Values.watcher.slack.webhookUrl | quote }}
  {{- end }}
  {{- end }}
